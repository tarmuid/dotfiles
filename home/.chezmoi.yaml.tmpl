{{- $profile := promptChoiceOnce . "profile" "What environment are you in" (list "home" "work") "work" -}}
{{- $name := "" -}}
{{- $email := "" -}}
{{- if eq $profile "work" -}}
  {{- $name = or (env "WORK_NAME") (promptStringOnce . "name" "What is your work name") -}}
  {{- $email = or (env "WORK_EMAIL") (promptStringOnce . "email" "What is your work email") -}}
{{- else -}}
  {{- $name = "tarmuid" -}}
  {{- $email = "tarmuid@roslev.net" -}}
{{- end -}}

{{- $availableShells := list "zsh" "fish" "nushell" -}}
{{- $availableBrowsers := list "brave" "safari" -}}
{{- $availableTerminals := list "ghostty" "kitty" "alacritty" "wezterm" "iterm2" -}}
{{- $availableEditors := list "nvim" "vim" "emacs" "vscode" "zed" -}}
{{- $availablePasswordManagers := list "1password" "bitwarden" "proton-pass" -}}
{{- $availableToolchains := list "mise" "go" "node" "python" "rust" -}}

{{- /* default programs: single choice per category */ -}}
{{- $shell := "zsh" -}}
{{- $browser := promptChoiceOnce . "defaults.browser" "Default browser" $availableBrowsers "brave" -}}
{{- $terminal := promptChoiceOnce . "defaults.terminal" "Primary terminal" $availableTerminals "iterm2" -}}
{{- $editor := promptChoiceOnce . "defaults.editor" "Primary editor" $availableEditors "nvim" -}}
{{- $passwordManager := promptChoiceOnce . "defaults.password_manager" "Primary password manager" $availablePasswordManagers "1password" -}}

{{- /* optional programs: multiple selections */ -}}
{{- $enabledShells := promptMultichoiceOnce . "programs.shells" "Enable shells" $availableShells (list $shell) -}}
{{- $enabledPasswordManagers := promptMultichoiceOnce . "programs.password_managers" "Enable password managers" $availablePasswordManagers (list $passwordManager) -}}
{{- $enabledTerminals := promptMultichoiceOnce . "programs.terminals" "Enable terminals" $availableTerminals (list $terminal) -}}
{{- $enabledEditors := promptMultichoiceOnce . "programs.editors" "Enable editors" $availableEditors (list $editor) -}}
{{- $enabledToolchains := promptMultichoiceOnce . "toolchains" "Enable language toolchains" $availableToolchains (list) -}}

{{- $xdgConfigHome := env "XDG_CONFIG_HOME" | default (printf "%s/.config" .chezmoi.homeDir) -}}
{{- $xdgCacheHome := env "XDG_CACHE_HOME" | default (printf "%s/.cache" .chezmoi.homeDir) -}}
{{- $xdgDataHome := env "XDG_DATA_HOME" | default (printf "%s/.local/share" .chezmoi.homeDir) -}}
{{- $xdgStateHome := env "XDG_STATE_HOME" | default (printf "%s/.local/state" .chezmoi.homeDir) -}}
{{- $xdgBinHome := env "XDG_BIN_HOME" | default (printf "%s/.local/bin" .chezmoi.homeDir) -}}

encryption: age
age:
  command: "rage"
  identity: {{ printf "%s/.config/chezmoi/key.txt" .chezmoi.homeDir | quote }}
  recipient: age10l3f3ldcx6s4jesnjmeksfuc086uftt732989np5vttg9nr8z5fsydymcx
data:
  name: {{ $name | quote }}
  email: {{ $email | quote }}
  signing_key: "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIH3h9tju97PYWlIax2f6vDPgj8kT3hmcvZGHf5CR0kXI"
  profile: {{ $profile | quote }}
  defaults:
    shell: {{ $shell | quote }}
    browser: {{ $browser | quote }}
    terminal: {{ $terminal | quote }}
    editor: {{ $editor | quote }}
    password_manager: {{ $passwordManager | quote }}
{{- if eq .chezmoi.os "darwin" }}
  homebrew:
    prefix: "/opt/homebrew"
{{- end }}
  programs:
    password_managers: {{ $enabledPasswordManagers | toJson }}
    terminals: {{ $enabledTerminals | toJson }}
    editors: {{ $enabledEditors | toJson }}
    shells: {{ $enabledShells | toJson }}
  toolchains: {{ $enabledToolchains | toJson }}
  xdg:
    configHome: {{ $xdgConfigHome | quote }}
    cacheHome: {{ $xdgCacheHome | quote }}
    dataHome: {{ $xdgDataHome | quote }}
    stateHome: {{ $xdgStateHome | quote }}
    binHome: {{ $xdgBinHome | quote }}
    
